[0m[1mterraform_data.this: Refreshing state... [id=c5248349-4696-1c9f-752a-42f626eb0a9a][0m
[0m[1mdata.archive_file.lambda_zip: Reading...[0m[0m
[0m[1maws_iam_user_policy_attachment.ssm_managed: Refreshing state... [id=terraform-user-20251019054420402000000003][0m
[0m[1maws_iam_user_policy_attachment.terraform_user_lambda_managed: Refreshing state... [id=terraform-user-20251019054420397500000002][0m
[0m[1maws_iam_user_policy_attachment.dynamodb_fullaccess: Refreshing state... [id=terraform-user-20251019054420397500000001][0m
[0m[1maws_iam_policy.terraform_user_api_gateway: Refreshing state... [id=arn:aws:iam::490004641263:policy/TerraformAPIGatewayPolicy][0m
[0m[1maws_apigatewayv2_api.chat_api: Refreshing state... [id=u9yhn9bsih][0m
[0m[1maws_sns_topic.alerts: Refreshing state... [id=arn:aws:sns:us-east-1:490004641263:chat-alerts][0m
[0m[1maws_iam_role.lambda_role: Refreshing state... [id=lambda-chatbot-role][0m
[0m[1maws_dynamodb_table.chat_history: Refreshing state... [id=chat-history][0m
[0m[1maws_apigatewayv2_stage.chat_stage: Refreshing state... [id=prod][0m
[0m[1maws_sns_topic_subscription.email_subscription: Refreshing state... [id=arn:aws:sns:us-east-1:490004641263:chat-alerts:4f8fbc70-4367-4fe1-a0cc-d07a39c023f4][0m
[0m[1mdata.archive_file.lambda_zip: Read complete after 2s [id=02e18fda326e54edcd58fb9696724bd0efa255c7][0m

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  [32m+[0m create[0m
  [33m~[0m update in-place[0m

Terraform will perform the following actions:

[1m  # aws_apigatewayv2_integration.chat_lambda_integration[0m will be created
[0m  [32m+[0m[0m resource "aws_apigatewayv2_integration" "chat_lambda_integration" {
      [32m+[0m[0m api_id                                    = "u9yhn9bsih"
      [32m+[0m[0m connection_type                           = "INTERNET"
      [32m+[0m[0m id                                        = (known after apply)
      [32m+[0m[0m integration_method                        = "POST"
      [32m+[0m[0m integration_response_selection_expression = (known after apply)
      [32m+[0m[0m integration_type                          = "AWS_PROXY"
      [32m+[0m[0m integration_uri                           = (known after apply)
      [32m+[0m[0m payload_format_version                    = "2.0"
      [32m+[0m[0m timeout_milliseconds                      = (known after apply)
    }

[1m  # aws_apigatewayv2_route.chat_route[0m will be created
[0m  [32m+[0m[0m resource "aws_apigatewayv2_route" "chat_route" {
      [32m+[0m[0m api_id             = "u9yhn9bsih"
      [32m+[0m[0m api_key_required   = false
      [32m+[0m[0m authorization_type = "NONE"
      [32m+[0m[0m id                 = (known after apply)
      [32m+[0m[0m route_key          = "POST /chat"
      [32m+[0m[0m target             = (known after apply)
    }

[1m  # aws_dynamodb_table.chat_history[0m will be updated in-place
[0m  [33m~[0m[0m resource "aws_dynamodb_table" "chat_history" {
        id                          = "chat-history"
        name                        = "chat-history"
        tags                        = {
            "Environment" = "dev"
            "Name"        = "chat-history"
        }
        [90m# (13 unchanged attributes hidden)[0m[0m

      [31m-[0m[0m global_secondary_index {
          [31m-[0m[0m hash_key           = "user_id" [90m-> null[0m[0m
          [31m-[0m[0m name               = "UserTimestampIndex" [90m-> null[0m[0m
          [31m-[0m[0m non_key_attributes = [] [90m-> null[0m[0m
          [31m-[0m[0m projection_type    = "ALL" [90m-> null[0m[0m
          [31m-[0m[0m range_key          = "timestamp" [90m-> null[0m[0m
          [31m-[0m[0m read_capacity      = 0 [90m-> null[0m[0m
          [31m-[0m[0m write_capacity     = 0 [90m-> null[0m[0m
        }

        [90m# (4 unchanged blocks hidden)[0m[0m
    }

[1m  # aws_iam_role_policy.lambda_inline_policy[0m will be created
[0m  [32m+[0m[0m resource "aws_iam_role_policy" "lambda_inline_policy" {
      [32m+[0m[0m id          = (known after apply)
      [32m+[0m[0m name        = "lambda-inline-policy"
      [32m+[0m[0m name_prefix = (known after apply)
      [32m+[0m[0m policy      = jsonencode(
            {
              [32m+[0m[0m Statement = [
                  [32m+[0m[0m {
                      [32m+[0m[0m Action   = [
                          [32m+[0m[0m "logs:CreateLogGroup",
                          [32m+[0m[0m "logs:CreateLogStream",
                          [32m+[0m[0m "logs:PutLogEvents",
                          [32m+[0m[0m "lambda:CreateFunction",
                          [32m+[0m[0m "lambda:GetFunction",
                          [32m+[0m[0m "lambda:UpdateFunctionCode",
                          [32m+[0m[0m "lambda:UpdateFunctionConfiguration",
                          [32m+[0m[0m "lambda:DeleteFunction",
                          [32m+[0m[0m "iam:PassRole",
                          [32m+[0m[0m "logs:CreateLogGroup",
                          [32m+[0m[0m "logs:CreateLogStream",
                          [32m+[0m[0m "logs:PutLogEvents",
                        ]
                      [32m+[0m[0m Effect   = "Allow"
                      [32m+[0m[0m Resource = "*"
                    },
                  [32m+[0m[0m {
                      [32m+[0m[0m Action   = [
                          [32m+[0m[0m "ce:GetCostAndUsage",
                        ]
                      [32m+[0m[0m Effect   = "Allow"
                      [32m+[0m[0m Resource = "*"
                    },
                  [32m+[0m[0m {
                      [32m+[0m[0m Action   = [
                          [32m+[0m[0m "dynamodb:PutItem",
                          [32m+[0m[0m "dynamodb:GetItem",
                          [32m+[0m[0m "dynamodb:Query",
                          [32m+[0m[0m "dynamodb:Scan",
                          [32m+[0m[0m "dynamodb:UpdateItem",
                        ]
                      [32m+[0m[0m Effect   = "Allow"
                      [32m+[0m[0m Resource = "*"
                    },
                  [32m+[0m[0m {
                      [32m+[0m[0m Action   = [
                          [32m+[0m[0m "ssm:GetParameter",
                          [32m+[0m[0m "ssm:PutParameter",
                        ]
                      [32m+[0m[0m Effect   = "Allow"
                      [32m+[0m[0m Resource = "*"
                    },
                  [32m+[0m[0m {
                      [32m+[0m[0m Action   = [
                          [32m+[0m[0m "sns:Publish",
                        ]
                      [32m+[0m[0m Effect   = "Allow"
                      [32m+[0m[0m Resource = "*"
                    },
                ]
              [32m+[0m[0m Version   = "2012-10-17"
            }
        )
      [32m+[0m[0m role        = "lambda-chatbot-role"
    }

[1m  # aws_iam_role_policy_attachment.lambda_logs[0m will be created
[0m  [32m+[0m[0m resource "aws_iam_role_policy_attachment" "lambda_logs" {
      [32m+[0m[0m id         = (known after apply)
      [32m+[0m[0m policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
      [32m+[0m[0m role       = "lambda-chatbot-role"
    }

[1m  # aws_iam_user_policy_attachment.attach_api_gateway[0m will be created
[0m  [32m+[0m[0m resource "aws_iam_user_policy_attachment" "attach_api_gateway" {
      [32m+[0m[0m id         = (known after apply)
      [32m+[0m[0m policy_arn = "arn:aws:iam::490004641263:policy/TerraformAPIGatewayPolicy"
      [32m+[0m[0m user       = "terraform-user"
    }

[1m  # aws_lambda_function.chatbot[0m will be created
[0m  [32m+[0m[0m resource "aws_lambda_function" "chatbot" {
      [32m+[0m[0m architectures                  = (known after apply)
      [32m+[0m[0m arn                            = (known after apply)
      [32m+[0m[0m code_sha256                    = (known after apply)
      [32m+[0m[0m filename                       = "./lambda.zip"
      [32m+[0m[0m function_name                  = "chatbot-lambda"
      [32m+[0m[0m handler                        = "handler.lambda_handler"
      [32m+[0m[0m id                             = (known after apply)
      [32m+[0m[0m invoke_arn                     = (known after apply)
      [32m+[0m[0m last_modified                  = (known after apply)
      [32m+[0m[0m memory_size                    = 512
      [32m+[0m[0m package_type                   = "Zip"
      [32m+[0m[0m publish                        = false
      [32m+[0m[0m qualified_arn                  = (known after apply)
      [32m+[0m[0m qualified_invoke_arn           = (known after apply)
      [32m+[0m[0m reserved_concurrent_executions = -1
      [32m+[0m[0m role                           = "arn:aws:iam::490004641263:role/lambda-chatbot-role"
      [32m+[0m[0m runtime                        = "python3.12"
      [32m+[0m[0m signing_job_arn                = (known after apply)
      [32m+[0m[0m signing_profile_version_arn    = (known after apply)
      [32m+[0m[0m skip_destroy                   = false
      [32m+[0m[0m source_code_hash               = "ZAq3Tyl+eEvnsJhkjO6qiLsPmW1dJWyPq37+JDm6Br0="
      [32m+[0m[0m source_code_size               = (known after apply)
      [32m+[0m[0m tags_all                       = (known after apply)
      [32m+[0m[0m timeout                        = 120
      [32m+[0m[0m version                        = (known after apply)

      [32m+[0m[0m environment {
          [32m+[0m[0m variables = {
              [32m+[0m[0m "DEEPSEEK_API_KEY" = (sensitive value)
            }
        }

      [32m+[0m[0m ephemeral_storage (known after apply)

      [32m+[0m[0m logging_config (known after apply)

      [32m+[0m[0m tracing_config (known after apply)
    }

[1m  # aws_lambda_permission.api_gateway_invoke[0m will be created
[0m  [32m+[0m[0m resource "aws_lambda_permission" "api_gateway_invoke" {
      [32m+[0m[0m action              = "lambda:InvokeFunction"
      [32m+[0m[0m function_name       = "chatbot-lambda"
      [32m+[0m[0m id                  = (known after apply)
      [32m+[0m[0m principal           = "apigateway.amazonaws.com"
      [32m+[0m[0m source_arn          = "arn:aws:execute-api:us-east-1:490004641263:u9yhn9bsih/*/*"
      [32m+[0m[0m statement_id        = "AllowAPIGatewayInvoke"
      [32m+[0m[0m statement_id_prefix = (known after apply)
    }

[1mPlan:[0m 7 to add, 1 to change, 0 to destroy.
[0m[90m
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m

Note: You didn't use the -out option to save this plan, so Terraform can't
guarantee to take exactly these actions if you run "terraform apply" now.
